CREATE PROCEDURE MIGRATION

AS
BEGIN

INSERT INTO XXBCM_SUPPLIER_CONTACT (SUPP_CONTACT_NAME,
									SUPP_CONTACT_NUMBER,
									SUPP_CONTACT_NUMBER_2
									)
SELECT DISTINCT (SUPPLIER_NAME),
       REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(regexp_substr(SUPP_CONTACT_NUMBER, '[^,]+', 1, 1), '.',''),'o','0'), 'S','5'),'I','1'),' ','') SUPP_CONTACT_NUMBER,
      REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(regexp_substr(SUPP_CONTACT_NUMBER, '[^,]+', 1, 2), '.',''),'o','0'), 'S','5'),'I','1'),' ','') SUPP_CONTACT_NUMBER_2
from   XXBCM_ORDER_MGT
ORDER BY SUPPLIER_NAME ASC;


INSERT INTO XXBCM_SUPPLIER(SUPPLIER_NAME,
							SUPP_CONTACT_NAME,
							SUPP_ADDRESS,
							SUPP_EMAIL)
    SELECT SUPPLIER_NAME,
    SUPPLIER_CONTACT_ID,
	SUPP_ADDRESS,
	SUPP_EMAIL
    FROM XXBCM_ORDER_MGT MGT
	LEFT JOIN XXBCM_SUPPLIER_CONTACT SC ON SC.SUPP_CONTACT_NAME = MGT.SUPP_CONTACT_NAME;


INSERT INTO XXBCM_INVOICE_STATUS
    SELECT DISTINCT INVOICE_STATUS
    FROM XXBCM_ORDER_MGT ;

INSERT INTO XXBCM_ORDER_STATUS
    SELECT DISTINCT ORDER_STATUS
    FROM XXBCM_ORDER_MGT ;

	
INSERT INTO XXBCM_ORDER
    SELECT 
	SUPPLIER_ID,
	ORDER_REF,
	TO_DATE(ORDER_DATE, 'dd-mm-YYYY','NLS_DATE_LANGUAGE = American'),
	TO_NUMBER(replace(replace(replace((NVL(ORDER_TOTAL_AMOUNT,0), ', ', '~ '), ',', ''), '~ ', ', ')),'9999999.99'),
	ORDER_DESCRIPTION,
	ORDER_STATUS_ID,
	TO_NUMBER(ORDER_LINE_AMOUNT,'99999.99'),
    FROM XXBCM_ORDER_MGT
	LEFT JOIN XXBCM_SUPPLIER ON SUPPLIER_NAME = SUPPLIER_NAME
	LEFT JOIN XXBCM_ORDER_STATUS ON DESCRIPTION = ORDER_STATUS;


INSERT INTO XXBCM_INVOICE
    SELECT ORDER_ID,
	INVOICE_REFERENCE,
	TO_DATE(INVOICE_DATE, dd-mm-YYYY,'NLS_DATE_LANGUAGE = American'),
	INVOICE_STATUS_ID,
	INVOICE_HOLD_REASON,
	TO_NUMBER(replace(replace(replace(replace((NVL(INVOICE_AMOUNT,0), ', ', '~ '), ',', ''), '~ ', ', '))),'o',0),'9999999.99'),
	INVOICE_DESCRIPTION
    FROM XXBCM_ORDER_MGT
	LEFT JOIN XXBCM_INVOICE_STATUS ON DESCRIPTION = INVOICE_STATUS;

END;